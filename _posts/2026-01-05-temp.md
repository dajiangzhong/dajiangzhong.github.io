---
title: "temp file"
date: 2026-01-05
categories:
  - temp 
tags: 
  - temp 
  - prompt 
---

##rule##you are architecture of the NVIDIA H100 B100 GPU driver and implemented all the GPU driver code. you know all things on H100 confidential computing design and implementation which using bounce buffer to extend the TVM's secure boundary to GPU to implemented GPU confidential computing as a result. ##background## attached is one research paper on H100 confidential computing ##Task## 1. in GPU Confidential Computing mode how to make TLP packet in PCIe link keep secret? Does it encrypt every TLP packet sending to/gettting from  the H100 GPU? please, elaborate it.
 
let me clarify the previous question aftet passed through the H100 to a TVM, in the TVM for some MMIO registers in GPU BAR space which is access by TVM's driver code through ioremap or similar kernel functions, how to make the operations (read/write) keeping secret?

In short: The TVM's driver accesses the GPU's MMIO registers directly and in plaintext, and this is secure because the untrusted host is physically blocked from seeing or interfering with those operations.

The entire system is designed so that once the TVM is established as the legitimate, attested owner of the GPU, it operates within an extended trusted boundary that includes the GPU itself. The "secret" is kept by ensuring that only the TVM can perform these accesses.

Attestation & Key Negotiation: Before any sensitive work begins, the TVM performs device attestation (via the GSP or SEC2 engine) to verify the GPU's firmware and security settings. Once trusted, they use the SPDM protocol to negotiate a unique master key. This key is the root of trust for their subsequent communication.

Firewall Reconfiguration: During GPU-CC initialization, the GPU's PCIe Firewall (BAR0 Decoupler) is programmed with a security policy. Crucially, this policy is set by the GPU's own trusted firmware (GSP-RM), not by the untrusted host. The policy does two things:

Blocks the Host: It makes nearly all BAR0 registers return zero to any read/write attempt originating from the host/hypervisor.

Allows the TVM: It permits the TVM's driver to access the necessary subset of registers. This works because the TVM's memory space, including its mapped BAR regions, is encrypted with the TVM's own key (e.g., via AMD SEV-SNP or Intel TDX). The GPU's IOMMU or internal access control can distinguish requests coming from this encrypted, trusted context.




==============makfil refine==========

##role## you are a senior expert on Linux kernel building system and Linux driver/module architecture and developer. 
##background##

1 my source source tree
.
├── cmodel
│   └── Damo_2024Q3-eHSM-C_MODEL_v2
│       └── C_MODEL
├── conf_compute
│   ├── cc_drv.h
│   ├── cc_keystore.h
│   ├── conf_compute.c
│   ├── conf_compute_context.h
│   ├── conf_compute.h
│   ├── conf_compute.o
│   ├── csl.c
│   ├── csl_context.h
│   ├── csl.h
│   ├── csl.o
│   ├── Makefile
│   ├── modules.order
│   ├── Module.symvers
│   ├── test.c
│   ├── test_csl.ko
│   ├── test_csl.mod
│   ├── test_csl.mod.c
│   ├── test_csl.mod.o
│   ├── test_csl.o
│   └── test.o
├── ehsm_host
│   ├── build
│   │   ├── CMakeCache.txt
│   │   ├── CMakeFiles
│   │   ├── cmake_install.cmake
│   │   ├── compile_commands.json
│   │   ├── ehsm_host_binary_loader
│   │   ├── ehsm_host_terminal
│   │   ├── ehsm_host_x86
│   │   └── Makefile
│   ├── build.sh
│   ├── cert
│   │   ├── ecdsap256
│   │   ├── ecdsap384
│   │   ├── sm2
│   │   └── spdm
│   ├── CMakeLists.txt
│   ├── libs
│   │   └── libspdm
│   └── src
│       ├── binary_loader
│       ├── component
│       ├── driver
│       ├── ehsm_host.mk
│       ├── main.cpp
│       ├── terminal_client
│       ├── test_bl1.cpp
│       ├── test_bl1.h
│       ├── test_bl2.cpp
│       ├── test_bl2.h
│       ├── testcase
│       ├── test.cpp
│       └── test.h
├── kernel
│   ├── cryptlib.mk
│   ├── hal
│   │   └── library
│   ├── internal
│   │   └── libspdm_lib_config.h
│   ├── internal_crypt_lib.h
│   ├── library
│   │   ├── cryptlib.h
│   │   └── spdm_lib_config.h
│   ├── libspdm_aead_aes_gcm.c
│   ├── libspdm_aead_aes_gcm.h
│   ├── libspdm_aead_aes_gcm.o
│   ├── libspdm_aead.c
│   ├── libspdm_aead.o
│   ├── libspdm_aead_sm4_gcm.c
│   ├── libspdm_aead_sm4_gcm.h
│   ├── libspdm_aead_sm4_gcm.o
│   ├── libspdm_ec.c
│   ├── libspdm_ecc_5.16.c
│   ├── libspdm_ecc_5_16.c
│   ├── libspdm_ecc.c
│   ├── libspdm_ecc.o
│   ├── libspdm_ec.o
│   ├── libspdm_hkdf.c
│   ├── libspdm_hkdf.o
│   ├── libspdm_hkdf_sha.c
│   ├── libspdm_hkdf_sha.o
│   ├── libspdm_hmac_sha.c
│   ├── libspdm_hmac_sha.o
│   ├── libspdm_internal_crypt_lib.c
│   ├── libspdm_internal_crypt_lib.o
│   ├── libspdm_rand.c
│   ├── libspdm_rand.o
│   ├── libspdm_rsa.c
│   ├── libspdm_rsa_ext.c
│   ├── libspdm_rsa_ext.o
│   ├── libspdm_rsa.o
│   ├── libspdm_sha.c
│   ├── libspdm_sha.h
│   ├── libspdm_sha.o
│   ├── libspdm_shash.c
│   ├── libspdm_shash.o
│   ├── libspdm_sm2.c
│   ├── libspdm_sm2.o
│   ├── libspdm_x509.c
│   ├── libspdm_x509.o
│   ├── Makefile
│   ├── spdm_cryptlib_extensions.h
│   ├── test
│   │   ├── Makefile
│   │   ├── modules.order
│   │   ├── Module.symvers
│   │   ├── test_aes.c
│   │   ├── test_aes.h
│   │   ├── test_aes.o
│   │   ├── test_alg.ko
│   │   ├── test_alg.mod
│   │   ├── test_alg.mod.c
│   │   ├── test_alg.mod.o
│   │   ├── test_alg.o
│   │   ├── test.c
│   │   ├── test_ecc.c
│   │   ├── test_ecc_cmodel.c
│   │   ├── test_ecc_cmodel.h
│   │   ├── test_ecc.h
│   │   ├── test_ecc.o
│   │   ├── test.o
│   │   ├── test_sha3.c
│   │   ├── test_sha3.h
│   │   ├── test_sha3.o
│   │   ├── test_sha.c
│   │   ├── test_sha.h
│   │   ├── test_sha.o
│   │   ├── test_sm2.c
│   │   ├── test_sm2.h
│   │   ├── test_sm2.o
│   │   ├── test_sm3.c
│   │   ├── test_sm3.h
│   │   ├── test_sm3.o
│   │   ├── test_sm4.c
│   │   ├── test_sm4.h
│   │   └── test_sm4.o
│   └── test_lkca.c
├── libspdm
│   ├── 3.1.1
│   │   ├── include
│   │   ├── library
│   │   ├── os_stub
│   │   └── unit_test
│   ├── 3.1.1_old_version
│   │   ├── include
│   │   ├── library
│   │   └── os_stub
│   └── damo
│       ├── openspdm.mk
│       ├── openspdm_responder.mk
│       ├── spdm_config.h
│       ├── spdm_crypt_null.c
│       ├── spdm_crypt_null.h
│       ├── spdm_crypt_null.o
│       ├── spdm_debuglib.c
│       ├── spdm_debuglib.o
│       ├── spdm_memlib.c
│       └── spdm_memlib.o
├── spdm
│   ├── libspdm_includes.h
│   ├── Makefile
│   ├── spdm.c
│   ├── spdm_certs.c
│   ├── spdm_certs.h
│   ├── spdm_context.h
│   ├── spdm_cryptlib_extensions.h
│   ├── spdm_device.c
│   ├── spdm_device.h
│   ├── spdm.h
│   ├── spdm.mk
│   ├── spdmrsakeys.h
│   ├── spdm_test_init.c
│   ├── spdm_test_init.h
│   ├── spdmtransport.h
│   ├── spdmvendordef.h
│   └── test.c
├── test_spdm_yufei.ko
├── user
│   ├── libgcrypt_aead_aes_gcm.c
│   ├── libgcrypt_aead_aes_gcm.h
│   ├── libgcrypt_aead_sm4_gcm.c
│   ├── libgcrypt_aead_sm4_gcm.h
│   ├── libgcrypt_aead_sm4_gcm.o
│   ├── Makefile
│   └── test.c
└── xdma
    ├─ include
    │   ├── libxdma_api.h
    │   └── Module.symvers
    └── kernel
        ├── cdev_bypass.c
        ├── cdev_bypass.o
        ├── cdev_ctrl.c
        ├── cdev_ctrl.h
        ├── cdev_ctrl.o
        ├── cdev_events.c
        ├── cdev_events.o
        ├── cdev_sgdma.c
        ├── cdev_sgdma.h
        ├── cdev_sgdma.o
        ├── cdev_xvc.c
        ├── cdev_xvc.h
        ├── cdev_xvc.o
        ├── libxdma.c
        ├── libxdma.h
        ├── libxdma.o
        ├── version.h
        ├── xdma_cdev.c
        ├── xdma_cdev.h
        ├── xdma_cdev.o
        ├── xdma_mod.c
        ├── xdma_mod.h
        ├── xdma_mod.o
        ├── xdma_thread.c
        ├── xdma_thread.h
        └── xdma_thread.o
2 Makefiles 
a. Makefiles (Makefile,spdm.mk) under directory spdm with build the test_spdm driver module 
Makefile content is as follows
"
KBUILD_EXTRA_SYMBOLS := $(PWD)/../xdma/include/Module.symvers
export KBUILD_EXTRA_SYMBOLS

ifneq ($(KERNELRELEASE),)

BUILD_OBJECT_LIST_WITH_DIR = \
  $(addprefix ../, $(addsuffix .o,$(basename $(1))))
BUILD_INCLUDE_LIST = \
  $(addprefix $(PWD)/../, $(basename $(1)))


XDMA_PATH := ../xdma/kernel
test_spdm-objs :=$(XDMA_PATH)/xdma_thread.o $(XDMA_PATH)/libxdma.o $(XDMA_PATH)/xdma_cdev.o $(XDMA_PATH)/cdev_ctrl.o $(XDMA_PATH)/cdev_events.o $(XDMA_PATH)/cdev_sgdma.o $(XDMA_PATH)/cdev_xvc.o $(XDMA_PATH)/cdev_bypass.o  $(XDMA_PATH)/xdma_mod.o 
test_spdm-objs += spdm.o spdm_certs.o spdm_device.o spdm_test_init.o test.o 

include $(PWD)/../libspdm/damo/openspdm.mk
LIBSPDM_OBJ := $(call BUILD_OBJECT_LIST_WITH_DIR,$(LIBSPDM_SOURCES))
LIBSPDM_INCLUDE_PATH := $(call BUILD_INCLUDE_LIST,$(LIBSPDM_INCLUDES))

include $(PWD)/../kernel/cryptlib.mk
CRYPTO_OBJ := $(call BUILD_OBJECT_LIST_WITH_DIR,$(CRYPTO_SOURCES))
CRYPTO_INCLUDE_PATH := $(call BUILD_INCLUDE_LIST,$(CRYPTO_INCLUDES))


include $(PWD)/../cmodel/Damo_2024Q3-eHSM-C_MODEL_v2/C_MODEL/c/cmodel.mk
$(info CMODEL_OBJ are: $(MODEL_SOURCES))
MODEL_OBJ := $(call BUILD_OBJECT_LIST_WITH_DIR,$(MODEL_SOURCES))

include $(PWD)/../ehsm_host/src/ehsm_host.mk
EHSM_OBJ :=$(call BUILD_OBJECT_LIST_WITH_DIR,$(EHSM_SOURCES))
$(info EHSM-OBJ are: $(EHSM_OBJ))


test_spdm-objs += $(LIBSPDM_OBJ)
test_spdm-objs += $(CRYPTO_OBJ)
test_spdm-objs += $(MODEL_OBJ)
test_spdm-objs += $(EHSM_OBJ)


obj-m += test_spdm.o

EXTRA_CFLAGS += -I$(PWD)/.. 
EXTRA_CFLAGS += -I$(PWD)/../libspdm/3.1.1/include -I$(PWD)/../libspdm/damo 
EXTRA_CFLAGS += -I$(PWD)/../kernel/hal -I$(PWD)/../kernel/internal -I$(PWD)/../kernel/library -I$(PWD)/../kernel 
EXTRA_CFLAGS += -I$(PWD)/../../cmodel/Damo_2024Q3-eHSM-C_MODEL_v2/C_MODEL/c 
EXTRA_CFLAGS += -I$(PWD)/../xdma/kernel -I$(PWD)/../xdma/include
EXTRA_CFLAGS += -I$(PWD)/../ehsm_host/src -I$(PWD)/../ehsm_host/src/driver 
# EXTRA_CFLAGS += -I$(LIBSPDM_INCLUDE_PATH)
# EXTRA_CFLAGS += -I$(CRYPTO_INCLUDE_PATH)
EXTRA_CFLAGS += -D$(LIBSPDM_DEFINES)

CFLAGS_MODULE="-Wno-error"

else

KDIR := /lib/modules/$(shell uname -r)/build
PWD := $(shell pwd)

all:
    $(MAKE)  -C $(KDIR) M=$(PWD) modules

clean:
    $(MAKE)  -C $(KDIR) M=$(PWD) clean
endif
"
spdm.mk content is as follows 
"
SPDM_SOURCES  :=
SPDM_INCLUDES :=

# Set some common path defines for readability.
SPDM_SOURCE_DIR := spdm

# List all files which depend on libspdm headers under SPDM_SOURCES.

SPDM_SOURCES += $(SPDM_SOURCE_DIR)/spdm_certs.c
SPDM_SOURCES += $(SPDM_SOURCE_DIR)/spdm_test_init.c
SPDM_SOURCES += $(SPDM_SOURCE_DIR)/spdm_device.c
SPDM_SOURCES += $(SPDM_SOURCE_DIR)/spdm.c

# Add all libspdm include paths required for the above SPDM_SOURCES to SPDM_INCLUDES.
SPDM_INCLUDES += $(SPDM_SOURCE_DIR)/include
"
b. Makefile (openspdm.mk) under directory libspdm 
openspdm.mk content
"
# SPDX-FileCopyrightText: Copyright (c) 2022-2023 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: MIT
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"),
# to deal in the Software without restriction, including without limitation
# the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the
# Software is furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
# DEALINGS IN THE SOFTWARE.

#
# Description: This makefile allows for the compilation of the libspdm
# open-source library, in order to implement an SPDM Requester in RM.
#

LIBSPDM_SOURCES  :=
LIBSPDM_INCLUDES :=
LIBSPDM_DEFINES  :=
USE_LIBSPDM   := 0

# Set some common path defines for readability.
LIBSPDM_SOURCE_DIR := libspdm
LIBSPDM_VERSION    := 3.1.1
#CONFIG_SPDM_RESPONDER := 0

# List all files which depend on libspdm headers under LIBSPDM_SOURCES.

# NVIDIA-authored module code which depends on libspdm headers.
# LIBSPDM_SOURCES += /home/yufei.wang/secure_driver/spdm/spdm.c
# LIBSPDM_SOURCES += /home/yufei.wang/secure_driver/spdm/spdm_certs.c
# LIBSPDM_SOURCES += /home/yufei.wang/secure_driver/spdm/spdm_device.c
# LIBSPDM_SOURCES += src/kernel/gpu/conf_compute/ccsl.c
# LIBSPDM_SOURCES += src/kernel/gpu/conf_compute/arch/hopper/conf_compute_keystore_gh100.c

# NVIDIA-authored platform code
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/damo/spdm_crypt_null.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/damo/spdm_debuglib.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/nvidia/nvspdm_malloclib.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/nvidia/nvspdm_rng.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/damo/spdm_memlib.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/nvidia/nvspdm_rsa.c

# libspdm source files
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_common_lib/libspdm_com_context_data.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_common_lib/libspdm_com_context_data_session.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_common_lib/libspdm_com_crypto_service.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_common_lib/libspdm_com_crypto_service_session.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_common_lib/libspdm_com_msg_log.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_common_lib/libspdm_com_opaque_data.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_common_lib/libspdm_com_support.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_crypt_lib/libspdm_crypt_aead.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_crypt_lib/libspdm_crypt_asym.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_crypt_lib/libspdm_crypt_cert.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_crypt_lib/libspdm_crypt_dhe.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_crypt_lib/libspdm_crypt_hash.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_crypt_lib/libspdm_crypt_hkdf.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_crypt_lib/libspdm_crypt_hmac.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_crypt_lib/libspdm_crypt_rng.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_common.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_communication.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_end_session.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_finish.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_get_capabilities.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_get_certificate.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_get_digests.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_get_measurements.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_get_version.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_handle_error_response.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_key_exchange.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_encap_certificate.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_encap_challenge_auth.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_encap_digests.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_encap_error.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_encap_key_update.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_encap_request.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_heartbeat.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_key_update.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_negotiate_algorithms.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_send_receive.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_requester_lib/libspdm_req_vendor_request.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_transport_mctp_lib/libspdm_mctp_common.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_transport_mctp_lib/libspdm_mctp_mctp.c
ifeq ($(CONFIG_SPDM_RESPONDER),y)
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_algorithms.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_capabilities.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_certificate.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_challenge_auth.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_chunk_get.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_chunk_send_ack.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_common.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_communication.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_csr.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_digests.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_encap_challenge.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_encap_get_certificate.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_encap_get_digests.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_encap_key_update.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_encap_response.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_end_session.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_error.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_finish.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_get_key_pair_info.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_handle_response_state.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_heartbeat.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_key_exchange.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_key_update.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_measurement_extension_log.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_measurements.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_psk_exchange.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_psk_finish.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_receive_send.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_respond_if_ready.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_set_certificate.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_set_key_pair_info_ack.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_subscribe_event_types_ack.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_supported_event_types.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_vendor_response.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_responder_lib/libspdm_rsp_version.c
endif
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_secured_message_lib/libspdm_secmes_context_data.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_secured_message_lib/libspdm_secmes_encode_decode.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_secured_message_lib/libspdm_secmes_key_exchange.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/library/spdm_secured_message_lib/libspdm_secmes_session.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/memlib/compare_mem.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/memlib/zero_mem.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/memlib/set_mem.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/memlib/copy_mem.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/spdm_device_secret_lib_null/lib.c

# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/spdm_device_secret_lib_sample/read_pub_cert.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/spdm_device_secret_lib_sample/event.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/spdm_crypt_ext_lib/spdm_crypt_ext.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/platform_lib_null/watchdog.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/platform_lib/watchdog.c
LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/platform_lib_null/time_linux.c
# LIBSPDM_SOURCES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/cryptlib_null/pem/pem.c

# Add all libspdm include paths required for the above LIBSPDM_SOURCES to LIBSPDM_INCLUDES.
LIBSPDM_INCLUDES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/include
# LIBSPDM_INCLUDES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/include/hal
# LIBSPDM_INCLUDES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/include
# LIBSPDM_INCLUDES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub
# LIBSPDM_INCLUDES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub/cryptlib_null
LIBSPDM_INCLUDES += $(LIBSPDM_SOURCE_DIR)/damo
# LIBSPDM_INCLUDES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/os_stub


# # Add all libspdm include paths required for the above TEST_REQUESTER_SOURCES to LIBSPDM_INCLUDES.
# LIBSPDM_INCLUDES += $(LIBSPDM_SOURCE_DIR)/$(LIBSPDM_VERSION)/unit_test/test_spdm_requester
# LIBSPDM_INCLUDES += ${LIBSPDM_SOURCE_DIR}/$(LIBSPDM_VERSION)/unit_test/include
# LIBSPDM_INCLUDES += ${LIBSPDM_SOURCE_DIR}/$(LIBSPDM_VERSION)/os_stub/spdm_device_secret_lib_sample
# LIBSPDM_INCLUDES += ${LIBSPDM_SOURCE_DIR}/$(LIBSPDM_VERSION)/unit_test/cmockalib/cmocka/include
# # LIBSPDM_INCLUDES += ${LIBSPDM_SOURCE_DIR}/unit_test/cmockalib/cmocka/include/cmockery
# LIBSPDM_INCLUDES += ${LIBSPDM_SOURCE_DIR}/$(LIBSPDM_VERSION)/unit_test/spdm_unit_test_common
# LIBSPDM_INCLUDES += ${LIBSPDM_SOURCE_DIR}/$(LIBSPDM_VERSION)/os_stub

# Override the default libspdm configuration with our own.
LIBSPDM_DEFINES  += LIBSPDM_CONFIG=\"spdm_config.h\"
"
c. ehsm_host.mk content under directory ehsm_host
ehsm_host.mk content
"
EHSM_SOURCES  :=
EHSM_INCLUDES :=
EHSM_DEFINES  :=
USE_EHSM_  := 0

# Set some common path defines for readability.
EHSM_DRIVER_DIR := ehsm_host/src/driver
EHSM_COMPONENT_DIR := ehsm_host/src/component

# EHSM source files
EHSM_SOURCES += $(EHSM_DRIVER_DIR)/api.c
EHSM_SOURCES += $(EHSM_DRIVER_DIR)/fpga_control.c
# EHSM_SOURCES += $(EHSM_DRIVER_DIR)/get_version.cpp
EHSM_SOURCES += $(EHSM_DRIVER_DIR)/mailbox.c
EHSM_SOURCES += $(EHSM_DRIVER_DIR)/mem.c
EHSM_SOURCES += $(EHSM_DRIVER_DIR)/utils.c
EHSM_SOURCES += $(EHSM_DRIVER_DIR)/xdma.c
EHSM_SOURCES += $(EHSM_COMPONENT_DIR)/volatile.c


# Add all libspdm include paths required for the above EHSM_SOURCES to EHSM_INCLUDES.
EHSM_INCLUDES += $(EHSM_DRIVER_DIR)
EHSM_INCLUDES += $(EHSM_DRIVER_DIR)/..

"
d. c_model.mk content under directory C_MODEL
"MODEL_SOURCES  :=
# Set some common path defines for readability.
MODEL_SOURCE_DIR := cmodel/Damo_2024Q3-eHSM-C_MODEL_v2/C_MODEL/c/

# MODEL source files
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/SKE/SM4.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/SKE/AES.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/SKE/utility.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/HFE/SM3/SM3.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/HFE/SHA224_SHA256/SHA224_SHA256.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/HFE/SHA384_SHA512/SHA384_SHA512.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/HFE/SHA3/SHA3.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/PKE/ECDSA/ECCP_curve.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/PKE/ECDSA/ECCP.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/PKE/ECDSA/ECDSA_ECDH.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/PKE/ECDSA/PAElib.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/PKE/SM2/RNG.c
MODEL_SOURCES += $(MODEL_SOURCE_DIR)/PKE/SM2/SM2.c"
e. cryptlib.mk content under directory kernel
"
CRYPTO_SOURCES  :=
CRYPTO_INCLUDES :=
CRYPTO_DEFINES  :=
USE_CRYPTO_  := 0

# Set some common path defines for readability.
CRYPTO_SOURCE_DIR := kernel

# CRYPTO source files
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_aead_aes_gcm.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_aead_sm4_gcm.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_aead.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_ec.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_ecc.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_hkdf_sha.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_hkdf.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_hmac_sha.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_internal_crypt_lib.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_rand.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_rsa_ext.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_rsa.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_sha.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_shash.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_sm2.c
CRYPTO_SOURCES += $(CRYPTO_SOURCE_DIR)/libspdm_x509.c


# Add all libspdm include paths required for the above CRYPTO_SOURCES to CRYPTO_INCLUDES.
CRYPTO_INCLUDES += $(CRYPTO_SOURCE_DIR)/hal
CRYPTO_INCLUDES += $(CRYPTO_SOURCE_DIR)/internal
CRYPTO_INCLUDES += $(CRYPTO_SOURCE_DIR)/library
CRYPTO_INCLUDES += $(CRYPTO_SOURCE_DIR)
"
##task## modify the Makefile under directory spdm to make all building object files and .ko files under directory spdm/build then I could clean all the object files in the building process and file .ko files very cleanly and don't taint source tree 


